<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Classroom</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4a90e2">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon.png">
    <link rel="manifest" href="manifest.json">

    <style>
        /* 1. å­—é«”è¨­å®š */
        @font-face {
            font-family: 'ZhuyinFont';
            src: url('./fonts/zhuyin.ttf') format('truetype'),
                 url('zhuyin.ttf') format('truetype');
            font-display: swap;
        }

        :root {
            --primary: #4a90e2;
            --hunter-bg: #e3f2fd;
            --angus-bg: #fff3cd;
        }

        body {
            font-family: "Microsoft JhengHei", -apple-system, sans-serif;
            background: #f4f6f8;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* å¼·åˆ¶å¥—ç”¨æ³¨éŸ³å­—é«” (ç‰¹åˆ¥åŠ ä¸Š .btn ç¢ºä¿æŒ‰éˆ•ä¹Ÿæœ‰è®Š) */
        .role-info h2, .role-info p, .menu-title, .menu-sub, .q-text, .q-sub, .opt-btn, .hint-toggle, .use-zhuyin, .btn {
            font-family: 'ZhuyinFont', "Microsoft JhengHei", sans-serif !important;
            font-weight: normal;
        }

        /* é˜²ä½œå¼Šï¼šè€ƒæ³¨éŸ³æ™‚ï¼Œé¡Œç›®å¤§å­—å¼·åˆ¶ç”¨é»‘é«” */
        .no-zhuyin {
            font-family: "Microsoft JhengHei", -apple-system, sans-serif !important;
        }

        /* é€šç”¨å…ƒä»¶ */
        .hidden { display: none !important; }
        .btn { border: none; border-radius: 16px; cursor: pointer; transition: 0.2s; font-weight: bold; outline: none; display: flex; align-items: center; justify-content: center; }
        .btn:active { transform: scale(0.96); }
        .icon-btn { background: #eee; width: 60px; height: 60px; border-radius: 50%; font-size: 30px; border: none; cursor: pointer; }
        
        .navbar { width: 100%; padding: 15px 25px; background: white; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; box-sizing: border-box; }
        .score-board { font-size: 24px; color: #555; font-weight: bold; font-family: -apple-system, sans-serif; }

        #home-view { display: flex; flex-direction: column; gap: 25px; margin-top: 8vh; width: 90%; max-width: 450px; }
        .role-card { background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); display: flex; align-items: center; gap: 25px; cursor: pointer; transition: 0.3s; }
        .role-card:active { transform: scale(0.98); }
        .role-avatar { font-size: 50px; background: #eee; width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .role-info h2 { margin: 0; font-size: 32px; color: #333; }
        .role-info p { margin: 8px 0 0; color: #888; font-size: 18px; }
        
        .hunter-app { background: var(--hunter-bg); }
        .angus-app { background: var(--angus-bg); }
        
        .menu-list { display: grid; grid-template-columns: 1fr; gap: 20px; width: 90%; max-width: 550px; padding: 20px 0; }
        .menu-item { background: white; padding: 25px; border-radius: 20px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-left: 10px solid var(--primary); display: flex !important; width: 100% !important; box-sizing: border-box; min-height: 100px; justify-content: center; align-items: center; }
        .menu-title { font-size: 36px; color: #333; margin: 0; display: inline-block; line-height: 1.4; white-space: nowrap; }
        .menu-sub { font-size: 18px; color: #888; display: block; margin-top: 5px; }

        .quiz-container { width: 95%; max-width: 900px; display: flex; flex-direction: column; align-items: center; padding-top: 20px; }
        .card { background: white; width: 100%; padding: 40px 20px; border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; margin-bottom: 30px; position: relative; box-sizing: border-box; }
        
        /* é¡Œç›®å¤§å­— (å‚ç›´å †ç–Šï¼šä¸Šå­—ä¸‹æ¨™é¡Œ) */
        .q-text { 
            font-size: 100px; 
            color: #333; 
            margin: 20px 0; 
            min-height: 120px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            line-height: 1.2; 
        }
        
        .q-sub { font-size: 24px; color: #666; margin-top: 5px; margin-bottom: 15px; white-space: nowrap; }

        /* é¸é …æ’ç‰ˆ (æ©«å‘ä¸€åˆ—) */
        .options-grid { 
            display: flex; 
            width: 100%; 
            gap: 20px; 
            flex-direction: row;       /* æ©«å‘æ’åˆ— */
            justify-content: center;   /* å±…ä¸­å°é½Š */
            flex-wrap: wrap;           /* å¹³æ¿å¤ å¯¬å°±ä¸€åˆ—ï¼Œä¸å¤ å¯¬å°±æ›è¡Œ */
        }

        .opt-btn { 
            background: white; 
            border: 4px solid #f0f0f0; 
            padding: 10px; 
            font-size: 52px; 
            border-radius: 25px; 
            color: #555; 
            min-height: 140px; 
            box-shadow: 0 6px 0 #ddd; 
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;                   /* å¹³å‡åˆ†é…å¯¬åº¦ */
            min-width: 150px;          /* æœ€å°å¯¬åº¦ */
            max-width: 300px;          /* æœ€å¤§å¯¬åº¦ */
            
            /* ç¢ºä¿å…§å®¹æ˜¯æ¨™æº–æ©«æ’ */
            writing-mode: horizontal-tb; 
        }

        .opt-btn:active { transform: translateY(6px); box-shadow: none; }
        .opt-btn.correct { background: #d4edda; border-color: #28a745; color: #155724; box-shadow: 0 6px 0 #1e7e34; }
        .opt-btn.wrong { background: #f8d7da; border-color: #dc3545; color: #721c24; box-shadow: 0 6px 0 #bd2130; }

        .numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; width: 100%; max-width: 500px; }
        .num-btn { background: white; padding: 20px; font-size: 32px; border-radius: 15px; box-shadow: 0 6px 0 #ccc; color: #333; border: 1px solid #ddd; }
        .num-btn:active { box-shadow: none; transform: translateY(6px); }
        .action-btn { background: var(--primary); color: white; box-shadow: 0 6px 0 #2a6bb3; border: none; }
        .half-btn { grid-column: span 3; background: #e1f5fe; font-size: 26px; }

        #math-input { font-size: 60px !important; height: 70px !important; margin-bottom: 20px; }
        .hint-toggle { margin-top: 15px; background: #fff3cd; color: #856404; padding: 10px 25px; font-size: 20px; border-radius: 25px; }
        canvas { background: white; border-radius: 50%; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; max-width: 100%; }
    </style>
</head>
<body>

    <nav id="navbar" class="navbar hidden">
        <div class="btn" onclick="goHome()" style="font-size:24px;">ğŸ </div>
        <div id="nav-title" style="font-size: 20px; color:#4a90e2;" class="use-zhuyin">Classroom</div>
        <div class="score-board">â­ <span id="score">0</span></div>
    </nav>

    <div id="home-view">
        <div class="role-card" onclick="selectRole('hunter')" style="border-left: 6px solid #4facfe;">
            <div class="role-avatar" style="background:#e3f2fd;">ğŸ‘¦</div>
            <div class="role-info">
                <h2>å“¥å“¥ Hunter</h2>
                <p>åœ‹èªã€æ•¸å­¸ã€è‹±æ–‡</p>
            </div>
        </div>
        <div class="role-card" onclick="selectRole('angus')" style="border-left: 6px solid #ff9a9e;">
            <div class="role-avatar" style="background:#fff3cd;">ğŸ‘¶</div>
            <div class="role-info">
                <h2>å¼Ÿå¼Ÿ Angus</h2>
                <p>æ³¨éŸ³ã€æ•¸æ•¸ã€æ™‚é˜</p>
            </div>
        </div>
    </div>

    <div id="app-container" class="hidden"></div>

    <script src="questions.js"></script>

    <script>
        // ==========================================
        // âš™ï¸ é‚è¼¯æ§åˆ¶ä¸­å¿ƒ
        // ==========================================
        let currentRole = null;
        let score = 0;
        let currentQ = null;
        let inputBuffer = ""; 
        let mathConfig = null;

        function selectRole(role) {
            currentRole = role;
            document.getElementById('home-view').classList.add('hidden');
            document.getElementById('navbar').classList.remove('hidden');
            document.getElementById('app-container').classList.remove('hidden');
            
            document.body.className = role === 'hunter' ? 'hunter-app' : 'angus-app';
            document.getElementById('nav-title').innerText = role === 'hunter' ? 'Hunter å°ˆå±¬' : 'Angus å°ˆå±¬';
            
            if (role === 'hunter') { showHunterCategories(); } 
            else { showAngusCategories(); }
        }

        function goHome() {
            document.getElementById('home-view').classList.remove('hidden');
            document.getElementById('navbar').classList.add('hidden');
            document.getElementById('app-container').classList.add('hidden');
            document.body.className = '';
            currentRole = null;
        }

        function showHunterCategories() {
            const container = document.getElementById('app-container');
            container.innerHTML = `<div class="menu-list" id="menu-list"></div>`;
            const list = document.getElementById('menu-list');

            addMenuItem(list, "ğŸ“š åœ‹èª", "", () => showHunterSubject('chinese'), '#ff9a9e');
            addMenuItem(list, "ğŸ”¢ æ•¸å­¸", "", () => showHunterSubject('math'), '#4facfe');
            addMenuItem(list, "ğŸ”¤ è‹±æ–‡", "", () => showHunterSubject('english'), '#a8e6cf');
        }

        function showHunterSubject(subject) {
            const container = document.getElementById('app-container');
            container.innerHTML = `<div class="menu-list" id="menu-list"></div>`;
            const list = document.getElementById('menu-list');

            addBackBtn(list, "â¬…ï¸ å›ç§‘ç›®é¸å–®", () => showHunterCategories());

            if (subject === 'chinese') {
                addMenuItem(list, "è½éŸ³é¸æ³¨éŸ³", "", () => startQuiz('h_zhuyin'));
                addMenuItem(list, "éƒ¨é¦–èˆ‡ç­†ç•«", "", () => startQuiz('h_char'));
            } else if (subject === 'math') {
                DB.hunter.mathUnits.forEach(u => addMenuItem(list, u.name, u.desc, () => startMath(u)));
            } else if (subject === 'english') {
                addMenuItem(list, "é›™èªç¹ªæœ¬å–®å­—", "è½éŸ³è¾¨å­—", () => startQuiz('h_english'));
            }
        }

        function showAngusCategories() {
            const container = document.getElementById('app-container');
            container.innerHTML = `<div class="menu-list" id="menu-list"></div>`;
            const list = document.getElementById('menu-list');

            addMenuItem(list, "ğŸ—£ï¸ æ³¨éŸ³", "", () => showAngusSubject('zhuyin'), '#ffd1dc');
            addMenuItem(list, "ğŸ æ•¸æ•¸", "", () => showAngusSubject('math'), '#fff5ba');
            addMenuItem(list, "ğŸ¶ è‹±æ–‡", "", () => showAngusSubject('english'), '#baffc9');
        }

        function showAngusSubject(subject) {
            const container = document.getElementById('app-container');
            container.innerHTML = `<div
